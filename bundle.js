(()=>{"use strict";window.map=document.querySelector(".map"),window.pinMain=document.querySelector(".map__pin--main"),window.mapPin=document.querySelector(".map__pin"),window.mapFilters=document.querySelector(".map__filters-container"),window.utils={getRandomNumber:(e,n)=>Math.floor(Math.random()*(n-e+1))+e,reduceArray(e){let n=[];for(let n=e.length-1;n>0;n--){let t=Math.floor(Math.random()*(n+1));[e[n],e[t]]=[e[t],e[n]]}for(let t=0;t<window.utils.getRandomNumber(0,e.length);t++)n[t]=e[t];return n},showErrorMessage(e){const n=document.createElement("div");n.style="border: 10px solid red; z-index: 100; margin: 0 auto; text-align: center; background-color: yellow; color: red; padding: 80px 0;",n.style.position="fixed",n.style.left=0,n.style.right=0,n.style.top="33vh",n.style.width="70%",n.style.fontSize="50px",n.textContent=e,document.body.insertAdjacentElement("afterbegin",n)}},window.download=function(e,n){const t=new XMLHttpRequest;t.responseType="json",t.addEventListener("load",(function(){200===t.status?e(t.response):n("Статус ответа: "+t.status+" "+t.statusText)})),t.addEventListener("error",(function(){n("Произошла ошибка соединения")})),t.timeout=1e4,t.addEventListener("timeout",(function(){n("Запрос не успел выполниться за "+t.timeout+" мс")})),t.open("GET","https://21.javascript.pages.academy/keksobooking/data"),t.send()},(()=>{window.MAX_PINS_NUMBER=5;const e=document.querySelector("#pin").content.querySelector(".map__pin");window.renderOffer=function(n){let t=e.cloneNode(!0);return t.querySelector("img").src=n.author.avatar,t.style.left=n.location.x-25+"px",t.style.top=n.location.y-70+"px",t},window.getOffersFromServer=function(){window.download((function(e){window.serverOffers=e;let n=document.createDocumentFragment();for(let e=0;e<window.MAX_PINS_NUMBER;e++)n.appendChild(window.renderOffer(window.serverOffers[e]));window.map.appendChild(n)}),(function(e){window.utils.showErrorMessage(e)}))}})(),document.querySelector("#housing-type").addEventListener("change",(function(e){const n=e.target.value;window.map.innerHTML="",window.map.appendChild(window.pinMain),window.map.appendChild(window.mapFilters),window.noticeForm.classList.add("ad-form--disabled");const t=window.serverOffers.filter((function(e){return"any"===n?window.serverOffers:e.offer.type===n}));let o=document.createDocumentFragment();const i=t.length>window.MAX_PINS_NUMBER?window.MAX_PINS_NUMBER:t.length;for(let e=0;e<i;e++)o.appendChild(window.renderOffer(t[e]));window.map.appendChild(o)})),(()=>{const e=window.pinMain.offsetWidth,n=window.pinMain.offsetHeight,t=document.querySelectorAll(".map__filter"),o=document.querySelector(".map__features"),i=document.querySelectorAll(".ad-form__element"),d=document.querySelector(".ad-form-header__input");window.noticeForm=document.querySelector(".ad-form"),window.mainPinInitialX=window.pinMain.offsetLeft,window.mainPinInitialY=window.pinMain.offsetTop,window.addressInput=document.querySelector("#address");const r=function(e){for(let n=0;n<t.length;n++)t[n].disabled=e;o.disabled=e;for(let n=0;n<i.length;n++)i[n].disabled=e;d.disabled=e};r(!0),window.pinMain.addEventListener("mousedown",(function(t){0===t.button&&(window.getOffersFromServer(),r(!1),window.map.classList.remove("map--faded"),window.noticeForm.classList.remove("ad-form--disabled"),window.addressInput.value=`${Math.round(window.mainPinInitialX+e/2)}, ${Math.round(window.mainPinInitialY+n+22)}`)})),window.pinMain.addEventListener("keydown",(function(t){"Enter"===t.key&&(window.getOffersFromServer(),r(!1),window.map.classList.remove("map--faded"),window.noticeForm.classList.remove("ad-form--disabled"),window.addressInput.value=`${Math.round(window.mainPinInitialX+e/2)}, ${Math.round(window.mainPinInitialY+n+22)}`)}))})(),(()=>{const e=["gif","jpg","jpeg","png"];let n=document.querySelector(".ad-form__field input[type=file]"),t=document.querySelector(".ad-form-header__preview img"),o=document.querySelector(".ad-form__upload input[type=file]"),i=document.querySelector(".ad-form__photo");n.addEventListener("change",(function(){let o=n.files[0],i=o.name.toLowerCase();if(e.some((function(e){return i.endsWith(e)}))){let e=new FileReader;e.addEventListener("load",(function(){t.src=e.result})),e.readAsDataURL(o)}})),o.addEventListener("change",(function(){let n=o.files[0],t=n.name.toLowerCase();if(e.some((function(e){return t.endsWith(e)}))){let e=new FileReader;e.addEventListener("load",(function(){i.innerHTML=`<img src="${e.result}" alt="Фото жилья" width="70" height="70"></img>`})),e.readAsDataURL(n)}}))})(),(()=>{const e=document.querySelector("#room_number"),n=document.querySelector("#capacity");window.addressInput.value=`${Math.round(window.mainPinInitialX+window.mainPinWidth/2)}, ${Math.round(window.mainPinInitialY+window.mainPinHeight/2)}`;const t=function(e,n){"100"===e.value&&"0"!==n.value?n.setCustomValidity("Этот номер не для гостей"):"100"!==e.value&&"0"===n.value?n.setCustomValidity("Этому варианту соответствует номер в 100 комнат"):"100"!==e.value&&(e.value<n.value||"0"===n.value)?n.setCustomValidity("Количество гостей не соответствует местам в номере"):n.setCustomValidity("")};t(e,n),n.addEventListener("change",(function(){t(e,n)})),e.addEventListener("change",(function(){t(e,n)}))})()})();